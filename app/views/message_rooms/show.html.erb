<div class="message-room">
  <%= link_to message_rooms_path do %>
    <div class="back-arrow text-dark"><</div>
  <% end %>
  <!-- show message dependent upon whose it is -->
  <div class="messages">
    <% @messages.each do |message| %>
      <% if message.user_id === current_user.id %>
        <%= render partial: "my_message", locals: {message: message, user: current_user} %>
      <% else %>
        <%= render partial: "other_message", locals: {message: message, user: message.user} %>
      <% end %>
    <% end %>
    <div class="panel-body hidden" id="new-message-target"></div>
  </div>
  <div class="message-input">
    <!-- only render the input if the user is subscribed -->
    <% if @subscribers.include?(current_user) %>
      <%= form_with(model: @message, remote: true) do |form| %>
        <div class="row mx-3 py-3">
            <%= form.text_field :body, class: "form-control col-sm-11 col-xs-10", id: "message-input" %>
            <%= form.hidden_field :user_id, value: current_user.id %>
            <div class="btn btn-primary col-sm-1 col-xs-2" onclick="clearInput()" onkeyup="clearInput()">Send</div>
        </div>
      <% end %>
    <% else %>
      
    <% end %>
  </div>
  <!-- list those that are subscribed to this message room -->
  <div class="w-50 mx-auto my-5">
    <h4>Message room followed by:</h4>
    <ul>
      <% @subscribers.each do |sub| %>
        <li><%= sub.username %> - <%= sub.initials %></li>
      <% end %>
    </ul>
  </div>
</div>

<script type="text/javascript">
  function clearInput() {
    $("form").submit()
    $("#message-input").val("");
  }

 $(document).ready(function(){
    $('#TextBoxId').keypress(function(e){
      if(e.keyCode==13)
      $('#linkadd').click();
    });
  });

  $('.messages').scrollTop($('.messages')[0].scrollHeight);
</script>
